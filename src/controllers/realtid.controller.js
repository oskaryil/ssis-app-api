/**
 * This notation was generated by templates.
 * // -------------------------------------------------
 * @description
 * @file realtid.controller.js
 * @author: Oskar Yildiz <oskar> 2018-04-22T10:34:23+02:00
 * // -------------------------------------------------
 * Make sure this file is part of its proper namespace
 * and project before moving on.
 * // -------------------------------------------------
 * Code-tags conventionally should be used (See below) :
 * TODO - Something that someone need to do.
 * DOING - Self remind for what you are doing.
 * CONSIDER - Reminder to consider a change or addition.
 * BUG - The below section of a code cause a bug.
 * FIXME - The below section of code need to be fixed.
 * HACK - The below section of code is a workaround.
 * XXX - Any notation important enough to consider implementing.
 * CLARIFY - Very incomprehensible section of code below.
 *
 * Created by Oskar Yildiz <oskar> on 2018-04-22T10:34:23+02:00.
 * Last modified by oskar on 2018-04-22T10:34:23+02:00
 *
 */

import Joi from 'joi';

import { getDepartures } from '../services/realtid';

export const validation = {
  getDepartures: {
    query: {
      site: Joi.string().required(),
      timeWindow: Joi.number().required(),
    },
  },
};

export const getDeparturesForSite = async (req, res) => {
  try {
    const sites = {
      'kista centrum': 9302,
      'kista alléväg': 3747,
    };
    const site = sites[req.query.site.toLowerCase()];
    const departures = await getDepartures({
      siteId: site,
      timeWindow: req.query.timeWindow,
      format: 'json',
    });
    res.status(200).json(departures);
  } catch (err) {
    return res
      .status(400)
      .json({ message: 'An error occured', err: err.message });
  }
};
